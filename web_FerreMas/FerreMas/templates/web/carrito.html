{% extends 'web/base.html' %}
{% load static %}

{% block nombrePag %}
<title>Carrito</title>
{% endblock %}

{% block contenido %}

<h1>Bienvenido, <span id="nombre-usuario">Cargando...</span> 🍅</h1>
<p>Tu correo es: <span id="correo-usuario">Cargando...</span></p>

<div id="foto-container">
  <img id="foto-usuario" src="" alt="Foto de perfil" style="width:100px; height:100px; border-radius:50%; object-fit:cover;">
</div>

<!-- Botón para cerrar sesión -->
<div style="margin-top:20px;">
  <button id="boton-logout" style="padding: 10px 20px; background-color: #e63946; color: white; border: none; border-radius: 8px; cursor: pointer;">
    Cerrar sesión
  </button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCAM_dosGr_VfJtMePggSQ0RZ2iDerHwWQ",
    authDomain: "ferremas-9ab69.firebaseapp.com",
    projectId: "ferremas-9ab69",
    storageBucket: "ferremas-9ab69.appspot.com",
    messagingSenderId: "647782254608",
    appId: "1:647782254608:web:8572f96398f846ccd6e295",
    measurementId: "G-LZLNBPKZC8"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();

  // Detectar usuario logueado
  onAuthStateChanged(auth, (user) => {
    if (user) {
      const nombre = user.displayName || "Sin nombre";
      const correo = user.email;
      const fotoURL = user.photoURL || "https://via.placeholder.com/100";

      document.getElementById('nombre-usuario').textContent = nombre;
      document.getElementById('correo-usuario').textContent = correo;
      document.getElementById('foto-usuario').src = fotoURL;
    } else {
      document.getElementById('nombre-usuario').textContent = "No conectado";
      document.getElementById('correo-usuario').textContent = "No conectado";
      document.getElementById('foto-usuario').src = "https://via.placeholder.com/100";
    }
  });

  // Función para cerrar sesión
  document.getElementById('boton-logout').addEventListener('click', async () => {
    try {
      await signOut(auth);
      alert('Has cerrado sesión correctamente.');
      window.location.href = '/acceso/'; // Redirigir al login o donde quieras
    } catch (error) {
      console.error('Error al cerrar sesión:', error);
      alert('Ocurrió un error al intentar cerrar sesión.');
    }
  });
</script>

{% endblock %}
